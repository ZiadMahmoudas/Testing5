<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…ÙˆÙ‚Ø¹Ùƒ ÙˆØ§Ù„Ø·Ù‚Ø³ Ø§Ù„Ø¢Ù†</title>
  <style>
    #map { height: 400px; margin-top: 20px; }
    body { font-family: sans-serif; direction: rtl; padding: 20px; background: #f9f9f9; }
    #location-data, #weather { background: #fff; padding: 15px; margin-top: 15px; border-radius: 10px; box-shadow: 0 0 5px #ccc; }
  </style>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
</head>
<body>

<h2 id="welcome">Ø¬Ø§Ø±Ù ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ...</h2>
<div id="location-data"></div>
<div id="weather">Ø¬Ø§Ø±ÙŠ Ø¬Ù„Ø¨ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·Ù‚Ø³...</div>
<div id="map"></div>

<script>
  const weatherApiKey = "0471c0b5c3db3e12e6a41ba29936ff40"; 
  const apiKey = "f49ccacc6ee2411daac4e9d251fa66e7";
  //
  async function fetchLocationDetails(lat, lon) {
    const url = `https://api.opencagedata.com/geocode/v1/json?q=${lat}+${lon}&key=${apiKey}&language=ar`;
    const res = await fetch(url);
    const data = await res.json();
    const components = data.results[0]?.components;
   
    return {
      city: components.city || components.town || components.state || "Ù…ÙˆÙ‚Ø¹ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
      country: components.country || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
      road: components.road ,
      postcode: components.postcode || "ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ",
      continent: components.continent
    };
  }
  //
  
  //
  async function fetchWeather(lat, lon) {
    const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${weatherApiKey}&units=metric&lang=ar`;
    const res = await fetch(url);
    const data = await res.json();
    
    return {
      temp: data.main.temp,
      humidity: data.main.humidity,
      description: data.weather[0].description,
      cityName: data.name
    };
  }
 //
 //
  navigator.geolocation.watchPosition(async function(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;

    const details = await fetchLocationDetails(lat, lon);
    document.getElementById("welcome").textContent = `Ù…Ø±Ø­Ø¨Ù‹Ø§ Ø¨Ùƒ ÙÙŠ ${details.city} ğŸ˜Š`;
    document.getElementById("location-data").innerHTML = `
      <strong>Ø§Ù„Ø¯ÙˆÙ„Ø©:</strong> ${details.country}<br>
      <strong>Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</strong> ${details.road}<br>
      <strong>Ø§Ù„Ø±Ù…Ø² Ø§Ù„Ø¨Ø±ÙŠØ¯ÙŠ:</strong> ${details.postcode}<br>
      <strong>Ø§Ù„Ù‚Ø§Ø±Ø© :</strong> ${details.continent}<br>
      <strong>Ø§Ù„Ø¥Ø­Ø¯Ø§Ø«ÙŠØ§Øª:</strong> (${lat.toFixed(5)}, ${lon.toFixed(5)})
    `;
    const weather = await fetchWeather(lat, lon);
    document.getElementById("weather").innerHTML = `
      <strong>Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©:</strong> ${weather.cityName}<br>
      <strong>Ø§Ù„Ø·Ù‚Ø³:</strong> ${weather.description}<br>
      <strong>Ø¯Ø±Ø¬Ø© Ø§Ù„Ø­Ø±Ø§Ø±Ø©:</strong> ${weather.temp}Â°C<br>
      <strong>Ø§Ù„Ø±Ø·ÙˆØ¨Ø©:</strong> ${weather.humidity}%
    `;
   //
    const map = L.map('map').setView([lat, lon], 15);
    
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {

    }).addTo(map);

    L.marker([lat, lon]).addTo(map)
      .bindPopup(`Ø£Ù†Øª Ù‡Ù†Ø§: ${details.city}`)
      .openPopup();
  //
  }, function(error) {
    document.getElementById("welcome").textContent = "Not Available Location please Check Setting to run";
  });

</script>

</body>
</html>